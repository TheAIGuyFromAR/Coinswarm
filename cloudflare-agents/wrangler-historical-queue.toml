#:schema node_modules/wrangler/config-schema.json
name = "historical-data-queue-producer"
main = "historical-data-queue-producer.ts"
compatibility_date = "2024-01-01"

# Run every 15 minutes
[triggers]
crons = ["*/15 * * * *"]

# D1 Database binding

# Producer Worker
name = "historical-data-queue-producer"
main = "historical-data-queue-producer.ts"
compatibility_date = "2024-01-01"

[[d1_databases]]
binding = "DB_PRODUCER"
database_name = "coinswarm-db"
database_id = "b37495a5-d7dc-4104-afab-4a9805eb5461"

[[queues.producers]]
queue = "historical-data-queue"
binding = "HISTORICAL_DATA_QUEUE"

[vars]
COINGECKO = "YOUR_COINGECKO_KEY"
CRYPTOCOMPARE_API_KEY = "YOUR_CRYPTOCOMPARE_KEY"

# Consumer Worker
[[d1_databases]]
binding = "DB_CONSUMER"
database_name = "coinswarm-db"
database_id = "b37495a5-d7dc-4104-afab-4a9805eb5461"

[[queues.consumers]]
queue = "historical-data-queue"
max_batch_size = 100
max_batch_timeout = 5
max_retries = 3
dead_letter_queue = "historical-data-dlq"
max_concurrency = 5

[limits]
cpu_ms = 30000

