#:schema node_modules/wrangler/config-schema.json
name = "historical-data-queue-consumer"
main = "historical-data-queue-consumer.ts"
compatibility_date = "2024-01-01"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "coinswarm-evolution"
database_id = "ac4629b2-8240-4378-b3e3-e5262cd9b285"

# Queue consumer configuration
[[queues.consumers]]
queue = "historical-data-queue"
max_batch_size = 100           # Process 100 messages at once
max_batch_timeout = 5          # Wait max 5 seconds for batch
max_retries = 3                # Retry failed batches 3 times
dead_letter_queue = "historical-data-dlq"  # Failed messages go here
max_concurrency = 5            # Run 5 consumer instances in parallel

# Limits
[limits]
cpu_ms = 30000  # 30 seconds CPU time (for large batches)
