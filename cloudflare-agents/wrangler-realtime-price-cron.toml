# Wrangler configuration for Real-Time Price Collection Cron Worker

name = "coinswarm-realtime-price-cron"
main = "realtime-price-collection-cron.ts"
compatibility_date = "2024-01-01"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "pyswarm-cccagg"
database_id = "b37495a5-d7dc-4104-afab-4a9805eb5461"

# Cron trigger - runs every minute
[triggers]
crons = ["* * * * *"]  # Every minute

# API Keys (Secrets - set via GitHub Secrets or `wrangler secret put`)
# DO NOT commit actual API keys to this file!
#
# To set secrets locally:
#   wrangler secret put COINGECKO --config wrangler-realtime-price-cron.toml
#   wrangler secret put CRYPTOCOMPARE_API_KEY --config wrangler-realtime-price-cron.toml
#
# To set via GitHub Actions, add to repository secrets:
#   COINGECKO - CoinGecko Demo/Pro API key
#   CRYPTOCOMPARE_API_KEY - CryptoCompare API key
#
# Intelligent round-robin with leaky bucket algorithm:
#   - CoinGecko: 15 calls/min (50% of 30)
#   - CryptoCompare: 15 calls/min (50% of 30)
#   - Binance.US: 600 weight/min (50% of 1200)
#   - DexScreener: 150 calls/min (50% of 300)
#
# Chooses source with highest available capacity percentage each minute
